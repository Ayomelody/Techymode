import zipfile
from pathlib import Path
import shutil

# ----------------------------
# CONFIGURATION
# ----------------------------
root = Path("/path/to/your/site")  # Change to your actual site folder

# Local paths to your favicon and logo (source files)
source_favicon = Path("/path/to/favicon.ico")  # Change this
source_logo = Path("/path/to/logo.png")        # Change this

# Destination paths in the site
assets_folder = root / "assets" / "images"
favicon_dest = assets_folder / "favicon.ico"
logo_dest = assets_folder / "logo.png"

# HTML link tags
favicon_link = '    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">\n'
apple_icon_link = '    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/logo.png">\n'

# ----------------------------
# 1. Ensure assets/images/ exists
# ----------------------------
assets_folder.mkdir(parents=True, exist_ok=True)

# ----------------------------
# 2. Copy favicon & logo if missing
# ----------------------------
if not favicon_dest.exists():
    shutil.copy2(source_favicon, favicon_dest)

if not logo_dest.exists():
    shutil.copy2(source_logo, logo_dest)

# ----------------------------
# 3. Update all HTML files
# ----------------------------
for html_file in root.rglob("*.html"):
    with open(html_file, "r", encoding="utf-8") as f:
        lines = f.readlines()

    # Skip if links already exist
    file_content = "".join(lines)
    if 'rel="icon"' in file_content and 'rel="apple-touch-icon"' in file_content:
        continue

    new_lines = []
    for line in lines:
        if "</head>" in line:
            new_lines.append(favicon_link)
            new_lines.append(apple_icon_link)
        new_lines.append(line)

    # Save the updated file
    with open(html_file, "w", encoding="utf-8") as f:
        f.writelines(new_lines)

# ----------------------------
# 4. Re-zip updated site
# ----------------------------
zip_path_favicon_update = "/mnt/data/techymode_site_with_favicon_links.zip"
with zipfile.ZipFile(zip_path_favicon_update, "w", zipfile.ZIP_DEFLATED) as z:
    for p in root.rglob("*"):
        z.write(p, p.relative_to(root.parent))

print(f"âœ… Updated site zipped at: {zip_path_favicon_update}")
